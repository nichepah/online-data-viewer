<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
  <title>
    SQLite with PHP
  </title>
  <meta http-equiv="Pragma" content="no-cache">
  <meta name="ROBOTS" content="INDEX,FOLLOW">
  <meta content="Nikolai Shokhirev" name="Author">
  <meta content="Database Tutorials,SQL,SQLite,create table,insert int table,update table" name="Keywords">
  <meta content="Delete,SQL command,SQL statement" name="keywords">
  <meta content="Sqlite with PHP step-by step tutorial" name="description">
  <style type="text/css">
<!--
#smaller
{
	font-size:smaller
}
#small_bold
{
  font-weight: bold;
  font-size:smaller
}
a:link {text-decoration: none}
a:visited {text-decoration: none}
a:active {text-decoration: none}
a:hover {text-decoration: none; color: red;}
pre {
  background-color: #CCFFFF;
}
#scr {
  background-color: #EEEEF0;
}
-->
</style>
</head>
<body background="SQLite%20with%20PHP_files/bg.gif" text="#000000">

<h1 align="center"><font color="#CC0066">SQLite with PHP</font></h1>

<p id="smaller" align="center">by Nikolai Shokhirev</p>

<p id="small_bold">
<a href="http://www.shokhirev.com/nikolai/abc/IT/ITtut.php">IT Tutorials </a> &nbsp;|
<a href="http://www.shokhirev.com/nikolai/abc/abc/ABCtut.php">ABC Tutorials </a> &nbsp;|
&nbsp; <a href="http://www.shokhirev.com/nikolai/index.php"> Home</a></p><h3>
Introduction
</h3>


<p>
This step-by-step tutorial originally was written for my colleagues at Dr. 
Walker's Research Grope when I worked at the University of Arizona.</p>


<p>
&nbsp;</p>


<p>
This is a practical guide to creation and management of SQLite database on your website.
We are going to create a web-based database of publications.
</p>


<p>
You need the following
</p>


<ol>
  <li>A personal web page at some server (usually at Linux computer).</li>
  <li>PHP5 or PHP4 with SQLite installed on the server</li>
  <li>File transfer and Shell client programs, assuming that you work from your
    PC (whatever is recommended at your computing center)</li>
  <li>Text file editor.&nbsp;</li>
</ol>
<p>The latter can be any text editor. For windows I recommend to download DevPHP
from <a href="http://devphp.sourceforge.net/">http://devphp.sourceforge.net/</a>
and install it. Versions 2 (stable) and <a href="http://devphp.sourceforge.net/dev3/">3
(alpha)</a> are available. See also the references below.</p>

<h4>References</h4>

<ol>
  <li>PHP 101, <a href="http://www.zend.com/php/beginners/">http://www.zend.com/php/beginners/</a></li>
  <li>PHP in a Nutshell, <a href="http://www.hudzilla.org/phpbook/index.php">http://www.hudzilla.org/phpbook/index.php</a></li>
  <li>SQLite homepage. <a href="http://www.sqlite.org/">http://www.sqlite.org/</a>&nbsp;</li>
  <li>SQL As Understood By SQLite, <a href="http://www.sqlite.org/lang.html">http://www.sqlite.org/lang.html</a></li>
  <li>SQLite My Fire! <a href="http://www.zend.com/php/beginners/php101-9.php">http://www.zend.com/php/beginners/php101-9.php</a>&nbsp;</li>
  <li>PHP Editor
  <a href="http://paginas.terra.com.br/informatica/php_editor/index_en.html">
  http://paginas.terra.com.br/informatica/php_editor/index_en.html</a> </li>
  <li>PHP Designer 2007 - Personal
  <a href="http://www.mpsoftware.dk/downloads.php">
  http://www.mpsoftware.dk/downloads.php</a> </li>
</ol>

<h3>&nbsp;</h3>

<h3>Credits</h3>

<p>Special thanks to Lucy M. Carruthers, principal research specialist&nbsp; at
CCIT of the University of Arizona for valuable consultations.</p>

<p>&nbsp;</p>

<h3>
Preliminary checks
</h3>


<p>
Suppose you just got a website, say <b>www.u.arizona.edu/~bob/</b>.
If someone types <b>http://www.u.arizona.edu/~bob/</b>&nbsp;in a browser and presses
Enter, the server at u.arizona.edu tries to find in Bob's directory index.html,
index.htm, default.htm ... . The list of files depends on a server
configuration.
</p>

<p>
Suppose you already have your index.html:
</p>

<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;The Home Page of Bob Smith&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to my homepage!&lt;/h1&gt;
    &lt;p&gt;My other stuff ...&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
If not, you can create one and upload it using the program recommended at
your computing center (e.g. SSH Secure File Transfer Client).
</p>


<p>We also assume that&nbsp; PHP is installed on your server. In this case the
file index.php is in the list of predefined files. Rename your index.html to
index.php and try http://www.u.arizona.edu/~bob/&nbsp;again. If it does not
work, contact your system administrator.
</p>


<p>Normally it should work because any HTML file is a valid PHP file as well. Let us
add some actual PHP functionality:&nbsp;
</p>


<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;The Home Page of Bob Smith&lt;/title&gt;
  &lt;/head&gt;
  &lt;body bgcolor = "#EEEEF0"&gt;
    &lt;h1&gt;Welcome to my homepage!&lt;/h1&gt;
    &lt;p&gt;My other stuff ...&lt;/p&gt;
<b>&lt;?php
  $s= $_SERVER['SCRIPT_FILENAME'];
  echo "SCRIPT_FILENAME = $s &lt;br&gt;";
  echo "DOCUMENT_ROOT = ".$_SERVER['DOCUMENT_ROOT']."&lt;br&gt;";
  echo 'PHP_SELF = '.$_SERVER['PHP_SELF'].'&lt;br&gt;';
//  phpinfo();
?&gt;
</b>  &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
If you run http://www.u.arizona.edu/~bob/index.php now, you get something
like this:
</p>

<div id="scr">
<h3>
Welcome to my homepage!
</h3>

<p>My other stuff ...
</p>

<p>
SCRIPT_FILENAME = /home/u123/bob/public_html/index.php<br>
DOCUMENT_ROOT = /home/httpd/www.u.arizona.edu<br>
PHP_SELF = /~bob/index.php
</p>
</div>
<p>It means that the internet address http://www.u.arizona.edu/~bob/index.php
corresponds to &nbsp;/home/u123/bob/public_html/index.php in the server file
system and
/home/u123/bob/public_html/ is Bob's web directory there.
</p>

<p>If you uncomment the last statement, you get much more information, in particular, PHP
and SQLite versions.
</p>

<p>SQLite is included in PHP5. If your web host is stuck with PHP4 (as in case
of u.arizona.edu) you must be sure that the database engine is installed.
</p>

<p>&nbsp;
</p>

<h3>Adding some security
</h3>

<p>The database is supposed to be publicly accessed from your page. However you
probably do not want to allow for everyone editing it. We are going to keep our
administrative scripts in a password-protected directory, say, /home/u123/bob/public_html/admin/
. We should place there the file called&nbsp; <b>.htaccess</b>
 - a file without a name and eight-letters extension:
</p>

<pre>AuthUserFile /home/u123/bob/hidden/.htpasswd
AuthGroupFile /dev/null
AuthName Restricted_Access
AuthType Basic

&lt;Limit GET POST&gt;
require valid-user
&lt;/Limit&gt;</pre>

<p>The CHMOD of an htaccess file should be 644 or (RW-
R-- R--). That setting makes it usable as well as more secure. The file refers to another file <b>.htpasswd</b>.
For better security we are going to put it outside the web directory:
/home/u123/bob/hidden/.htpasswd
</p>

<p><span style="font-size: 12.0pt; font-family: Times New Roman; mso-fareast-font-family: Times New Roman; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">The
file
<b>.</b></span><b>htpasswd</b>
 contains one line per user - a pair username and password (encrypted):
</p>

<pre>adminuser:x0ysJcLr78iE2</pre>

<p>&nbsp;To create this file, start your shell client and cd to /home/u123/bob/hidden/,
then type <b> htpasswd -c .htpasswd user_name </b> (say, adminuser). This
command creates the file and adds
"<b>adminuser</b>" as the first user. The program will prompt you for a 
password, then verify by asking again. You will not see the password 
when entering it:
</p>

<div id="scr">
htpasswd -c .htpasswd adminuser<br>
<br>
Adding password for adminuser.<br>
<br>
New password:<br>
<br>
<i>password</i><br>
<br>
Re-type new password:<br>
<br>
<i>password</i>
</div>

<p>To add more users in the future, use the same command without the <b> -c</b> switch.
To delete users, open the .htpasswd file in a text editor and delete the appropriate
line.
</p>

<p>Alternatively you can create the above files at your PC and upload them to
the appropriate directories. Refer to the following tutorials <a href="http://www.soundfeelings.com/free/password.htm">http://www.soundfeelings.com/free/password.htm</a> 
, <a href="http://www.password-protection.com/">
http://www.password-protection.com/</a>
and <a href="http://www.htmlite.com/HTA001.php">http://www.htmlite.com/HTA001.php</a>&nbsp;.
</p>

<p><b>A database file must be in a directory with a full read/write access</b>
 (CHMOD set to 777). Therefore
the file needs to be kept somewhere it cannot be accessed through the 
browser by visitors to your site. That means that you need to create it 
outside your
web directory (public_html, in this example). We are going to keep it in
/home/u123/bob/refdb/ (one level above).
</p>

<p>&nbsp;
</p>

<h3>Database design
</h3>

<p>Our database will contain only journal references. It will consist of two
tables.
</p>

<p>Table ref_list
</p>

<table border="1">
  <tbody><tr>
    <td>Field</td>
    <td>Type</td>
    <td>Commet</td>
  </tr>
  <tr>
    <td>ridx</td>
    <td>INTEGER, NOT NULL, AUTOINCREMENT&nbsp;</td>
    <td>Record index</td>
  </tr>
  <tr>
    <td>authors</td>
    <td>TEXT, NOT NULL</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>title</td>
    <td>TEXT, NOT NULL</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>volume</td>
    <td>VARCHAR(6)</td>
    <td>not necessarily integer</td>
  </tr>
  <tr>
    <td>year</td>
    <td>INTEGER</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>pages</td>
    <td>VARCHAR(20)</td>
    <td>e.g. 123456-234567</td>
  </tr>
  <tr>
    <td>no</td>
    <td>VARCHAR(6)</td>
    <td>not necessarily integer</td>
  </tr>
  <tr>
    <td>keywords&nbsp;</td>
    <td>TEXT</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>jidx</td>
    <td>INTEGER, NOT NULL</td>
    <td>&nbsp;foreign key from journals&nbsp;</td>
  </tr>
</tbody></table>

<p>Table joutnals
</p>


<table border="1">
  <tbody><tr>
    <td>Field</td>
    <td>Type</td>
    <td>Commet</td>
  </tr>
  <tr>
    <td>jidx</td>
    <td>INTEGER, NOT NULL, AUTOINCREMENT&nbsp;</td>
    <td>Record index</td>
  </tr>
  <tr>
    <td>jname</td>
    <td>TEXT, NOT NULL</td>
    <td>&nbsp;</td>
  </tr>
</tbody></table>

<p>In SQLite the primary key is AUTOINCREMENT by default. Also SQLite does not
enforce field length, so we can use TEXT instead of VARCHAR(N).
</p>


<p>The tables can be created with the following SQL scripts:
</p>


<pre>create table ref_list (
  ridx INTEGER PRIMARY KEY,
  authors TEXT NOT NULL,
  title TEXT NOT NULL,
  volume TEXT,
  year INTEGER NOT NULL,
  pages TEXT,
  no TEXT,
  keywords TEXT,
  jidx INTEGER NOT NULL);</pre>

<pre>create table journals (
  jidx INTEGER PRIMARY KEY,
  jname TEXT NOT NULL);</pre>

<p>&nbsp;
</p>

<h3>Database management
</h3>

<p>We need to view the list of references, add new articles and journals, edit
and delete existing records. There are a lot of database management tools. In
particular, PHP5 comes with SQLite Admin. For a training purpose we are going to
make our own simple tools.
</p>

<h4>Control page
</h4>

<p>First, make manage_db.html file
</p>


<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;DB Management&lt;/title&gt;
  &lt;/head&gt;
  &lt;body bgcolor = "#EEEEF0"&gt;
    &lt;h2&gt;DB Management&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="create_db.php"&gt;Create/Info&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="add_new.php"&gt;Add new record&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="edit_db.php"&gt;Edit/delete record&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="show_all.php"&gt;Show All references&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
  &lt;/body&gt;
&lt;/html&gt;&nbsp;</pre>


<p>and put it in our secure <b>admin</b> directory.&nbsp;
</p>

<p>The page looks as</p>
<div id="scr">

    <h2>DB Management</h2>
<ul>
  <li><a href="#">Create/Info</a></li>
  <li><a href="#">Add new record</a></li>
  <li><a href="#">Edit/delete record</a></li>
  <li><a href="#">Show All references</a></li>
</ul>
</div>


<p>In index.php add a link to this file:
</p>

<pre>&lt;a href="admin/manage_db.html"&gt;DB management&lt;/a&gt;&nbsp;</pre>

<h4>Create/Info script
</h4>

<p>&nbsp;File create_db.php
</p>

<pre>&nbsp;&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Create/Info Ref DB&lt;/title&gt;
  &lt;/head&gt;
  &lt;body bgcolor = "#EEEEF0"&gt;
    &lt;h2&gt;Ref DB Info&lt;/h2&gt;
&lt;?php
<font color="#FF00FF">// define constants</font>
$jt = 'journals';
$rt = 'ref_list';
$db = '/home/u123/bob/refdb/ref_db.sqlite';

function sqlite_table_exists($dh, $mytable)
{
  $result = sqlite_query($dh,"SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='$mytable'");
  <font color="#FF00FF">// casts into integer</font>
  $count = intval(sqlite_fetch_single($result));
    return $count &gt; 0;
}

function sqlite_table_list($dh)
{
  $result = sqlite_query($dh,"SELECT name FROM sqlite_master WHERE type='table'");
  if (sqlite_num_rows($result) &gt; 0)
  {
	$s = 'Tables:&lt;br /&gt;';
    while (sqlite_has_more($result)) {
      $row = sqlite_fetch_single($result);
      $s .= $row.'&lt;br /&gt;';
    }
  }
  else
  {
    $s = 'Empty DB: No tables';
  }
  return $s;
}

// checking if SQLite library is loaded, just in case ...
if (!extension_loaded("sqlite"))
{
  echo 'sqlite was not loaded, loading . . .&lt;br /&gt;';
  dl("sqlite.so");
}
else
{
  echo 'sqlite was already loaded, OK&lt;br /&gt;';
}
<font color="#FF00FF">// general info</font>
echo 'version: '.sqlite_libversion().'&lt;br /&gt;';
echo 'libencoding: '.sqlite_libencoding().'&lt;br /&gt;';
echo 'db file='.$db.'&lt;br&gt;';

<font color="#FF00FF">// databse handle</font>
$dh = sqlite_open($db, 0666, $err) or die ($err); <font color="#FF00FF">// open if exists, create if not</font>
echo sqlite_table_list($dh).'&lt;br /&gt;';

<font color="#FF00FF">// journals</font>
if (!sqlite_table_exists($dh,$jt)) <font color="#FF00FF">// 'journals' does not exists, creating</font>
{
  $sql = "create table $jt (jidx INTEGER PRIMARY KEY, jname TEXT NOT NULL)";
  $result = sqlite_query($dh, $sql) or
            die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
  echo " Table $jt was created&lt;br&gt;";  <font color="#FF00FF">// double-quoted string can embed variables, $jt in this case</font>
}
else
{
  $sql = "SELECT jidx FROM $jt";
  $result = sqlite_query($dh, $sql);
  $num = sqlite_num_rows($result);
  echo " Table $jt has $num records&lt;br&gt;";
}
<font color="#FF00FF">// ref_list</font>
if (!sqlite_table_exists($dh,$rt))
{
  $sql = "create table $rt (ridx INTEGER PRIMARY KEY, authors TEXT NOT NULL,
          title TEXT NOT NULL, volume TEXT, year INTEGER NOT NULL,
		  pages TEXT, no TEXT, keywords TEXT, jidx INTEGER NOT NULL)";
  $result = sqlite_query($dh, $sql) or
            die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
  echo " Table $rt was created&lt;br&gt;";
}
else
{
  $sql = "SELECT ridx FROM $rt";
  $result = sqlite_query($dh, $sql);
  $num = sqlite_num_rows($result);
  echo " Table $rt has $num records&lt;br&gt;";
}
// all done, close database file
sqlite_close($dh);
?&gt;
  &lt;p&gt;
  &lt;a href="pages/manage_db.html"&gt;Back to management&lt;/a&gt;
  &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

<p>This script creates our database and tables if they were not existed.
Next time you run, it gives some genereal DB information.
</p>

<h4>Refactoring
</h4>

<p>We are going to use the same constants and functions in all our files.
Instead of using an ancient "copy and paste" technique, cut them once
and put the code in a separate file sqlite_utils.php.
</p>

<pre>&lt;?php
$jt = 'journals';
$rt = 'ref_list';
$db = '/home/u123/bob/refdb/ref_db.sqlite';

function sqlite_is_empty($dh)
{
  $result = sqlite_query($dh,"SELECT name FROM sqlite_master WHERE type='table'");
  return (sqlite_num_rows($result) == 0);
}

function sqlite_table_exists($dh, $mytable)
{
  <font color="#FF00FF">// counts the tables that match the name given</font>
  $result = sqlite_query($dh,"SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name='$mytable'");
  <font color="#FF00FF">// casts into integer</font>
  $count = intval(sqlite_fetch_single($result));
  return $count &gt; 0;
}

function sqlite_table_list($dh)
{
  $result = sqlite_query($dh,"SELECT name FROM sqlite_master WHERE type='table'");
  if (sqlite_num_rows($result) &gt; 0)
  {
	$s = 'Tables:&lt;br /&gt;';
    while (sqlite_has_more($result)) {
      $row = sqlite_fetch_single($result);
      $s .= $row.'&lt;br /&gt;';
    }
  }
  else
  {
    $s = 'Empty DB: No tables';
  }
  return $s;
}

if (!extension_loaded("sqlite"))
{
  dl("sqlite.so");
};
?&gt;</pre>
<p>&nbsp;Now instead of actual pasting we just call include('sqlite_utils.php');
</p>


<h4>Add new record
</h4>


<p>File add_new.php:
</p>


<pre>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Add new record&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgcolor = "#EEEEF0"&gt;
&lt;?php
<b>include('sqlite_utils.php');</b>
$dh = sqlite_open($db, 0666, $err) or die ($err);

if (!sqlite_is_empty($dh))
{
  $sql = "SELECT * FROM $jt";
  $result = sqlite_query($dh, $sql);

  if (sqlite_num_rows($result) &gt; 0)
  {
    <font color="#FF00FF">// drop-down menu generation</font>
    $option = '&lt;select name="jname"&gt;'."\n";
    while($row = sqlite_fetch_array($result))
    {
      $option .= '&lt;option value='.$row[0].'&gt;'.$row[1].'&lt;/option&gt;'."\n";
    }
    $option .= "&lt;/select&gt;\n";
  }
  <font color="#FF00FF">// check to see if the form was submitted with a new journal name</font>
  if (isset($_POST['submit']))
  {
    if (!empty($_POST['new_jname']) )
    {
      $jname = sqlite_escape_string($_POST['new_jname']);
      $sql = 'INSERT INTO '.$jt.' (jidx,jname) VALUES (NULL, "'.$jname.'")';
	  $result = sqlite_query($dh, $sql)
	            or die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
	  echo "&lt;p&gt;&lt;i&gt;Journal successfully inserted!&lt;/i&gt;&lt;/p&gt;";

      $sql = "SELECT * FROM $jt";  <font color="#FF00FF">// for sorting add: <b>ORDER BY jname</b></font>
      $result = sqlite_query($dh, $sql);
      if (sqlite_num_rows($result) &gt; 0)
      {
        $option = '&lt;select name="jname"&gt;'."\n";
	    while($row = sqlite_fetch_array($result))
	    {
	      $option .= '&lt;option value='.$row[0].'&gt;'.$row[1].'&lt;/option&gt;'."\n";
	    }
	    $option .= "&lt;/select&gt;\n";
      }
    }
    else
    {
      echo "&lt;p&gt;&lt;i&gt;Incomplete form input. Record not inserted!&lt;/i&gt;&lt;/p&gt;";
    }
  }

 <font color="#FF00FF">// check to see if the form was submitted with a new article reference</font>
  if (isset($_POST['save']))
  {
    if (!empty($_POST['authors']) &amp;&amp; !empty($_POST['title']) &amp;&amp; !empty($_POST['year']) )
    {
	  $authors = sqlite_escape_string($_POST['authors']);
	  $title = sqlite_escape_string($_POST['title']);
	  $jidx = sqlite_escape_string($_POST['jname']);
	  $volume = sqlite_escape_string($_POST['volume']);
	  if ( empty($_POST['volume']) ) {
	    $volume = 'NULL';
	  } else {
	    $volume = "'".sqlite_escape_string($_POST['volume'])."'";
	  }
	  $year = sqlite_escape_string($_POST['year']);
	  $pages = sqlite_escape_string($_POST['pages']);
	  if ( empty($_POST['no']) ) {
	    $no = 'NULL';
	  } else {
	    $no = "'".sqlite_escape_string($_POST['no'])."'";
	  }
	  $keywords = sqlite_escape_string($_POST['keywords']);
	  $sql = "INSERT INTO $rt (ridx,authors,title,volume,year,pages,no,keywords,jidx)
	          VALUES (NULL,'$authors','$title',$volume,$year,'$pages',$no,'$keywords',$jidx);";
<font color="#FF00FF">//	   echo "sql = $sql&lt;br /&gt;"; // un-comment for debugging</font>
	  $result = sqlite_query($dh, $sql) or die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
	  echo "&lt;p&gt;&lt;i&gt;Record successfully inserted!&lt;/i&gt;&lt;/p&gt;";
    }
    else
    {
      echo "&lt;p&gt;&lt;i&gt;Incomplete form input. Record not inserted! Go Back&lt;/i&gt;&lt;/p&gt;";
    }
  }
}
else
{
  echo 'Create DB first:&lt;br /&gt;';
}
  sqlite_close($dh);
?&gt;
&lt;h3&gt;Enter new record:&lt;/h3&gt;
&lt;form method="post" action="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"&gt;
&lt;br /&gt;
&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;Authors: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="authors" size="80"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Title: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="title" size="80"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Select Journal: &lt;/td&gt;&lt;td&gt;&lt;?php echo $option;?&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Volume: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="volume" size="8"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Year: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="year" size="6"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Pages: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="pages"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;No: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="no" size="8" value =""&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Keywords: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="keywords" size="80"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;input type="submit" name="save" value="Save"&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=reset value="Clear All"&gt;&lt;/td&gt;
&lt;/table&gt;
&lt;p&gt;
  &lt;a href="manage_db.html"&gt;Back to management&lt;/a&gt;
&lt;/p&gt;
&lt;hr /&gt;
Update Journal List&lt;br /&gt;
New Journal: &lt;input type="text" name="new_jname"&gt; &amp;nbsp;
&lt;input type="submit" name="submit" value="Update"&gt;
&lt;/form&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</pre>


<p>The page looks like this</p>
<div id="scr">

    <h3>Enter new record</h3>
<form method="post" action="">
<br>
<table>
  <tbody><tr><td>Authors: </td><td><input name="authors" size="80" type="text"></td></tr>
  <tr><td>Title: </td><td><input name="title" size="80" type="text"></td></tr>
  <tr><td>Select Journal: </td><td><select name="jname"><option selected="selected" value="1">Chem. Phys.</option>
  <option value="1">Phys. Chem.</option></select></td></tr>
  <tr><td>Volume: </td><td><input name="volume" size="8" type="text"></td></tr>
  <tr><td>Year: </td><td><input name="year" size="6" type="text"></td></tr>
  <tr><td>Pages: </td><td><input name="pages" type="text"></td></tr>
  <tr><td>No: </td><td><input name="no" size="8" type="text"></td></tr>
  <tr><td>Keywords: </td><td><input name="keywords" size="80" type="text"></td></tr>
  <tr><td><input name="save" value="Save" type="submit"></td><td><input value="Clear All" type="reset"></td>
</tr></tbody></table>
<p>
  <a href="#">Back to management</a>
</p>
<hr>
Update Journal List<br>
New Journal: <input name="new_jname" type="text"> &nbsp;
<input name="submit" value="Update" type="submit">
</form>
</div>

<b>Note</b>: Add at least one journal before entering the other fields!


<h4>Show All references</h4>
<p>File show_all.php:</p>
<pre>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Show all records&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgcolor = "#EEEEF0"&gt;
&lt;?php
include('sqlite_utils.php');
$dh = sqlite_open($db, 0666, $err) or die ($err);

if (!sqlite_is_empty($dh))
{
<b>  $sql = "SELECT r.ridx,r.authors,r.title,j.jname,r.volume,r.year,r.pages,r.no
          FROM $rt r, $jt j WHERE r.jidx=j.jidx" ;
</b>  $result = sqlite_query($dh, $sql);

  if (sqlite_num_rows($result) &gt; 0)
  {
	<b>$linenumber</b> = 0;
	$refs = '';
	while($row = sqlite_fetch_array($result))
	{
	  if (is_null($row[4])) {$v = ''; } else {$v =  " &lt;b&gt;$row[4]&lt;/b&gt;,";}
	  if (is_null($row[7])) {$n = ''; } else {$n =  " No $row[7],";}
	  if (is_null($row[6])) {$p = '.'; } else {$p =  ", $row[6].";}
	  $linenumber++;
	  $refs .= "$linenumber. $row[1]. $row[2]. &lt;i&gt;$row[3]&lt;/i&gt;,$v$n $row[5] $p&lt;br /&gt;";
	}
	$refs = stripslashes($refs);
  }
}
else
{
  echo 'Create DB first!&lt;br /&gt;';
}
  // all done, close database file
  sqlite_close($dh);
?&gt;

&lt;p&gt;
&lt;h3&gt;References&lt;/h3&gt;

&lt;?php echo $refs; ?&gt;
&lt;br /&gt;
&lt;p&gt;
  &lt;a href="manage_db.html"&gt;Back to management&lt;/a&gt;
&lt;/p&gt;
&lt;/form&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;</pre>

<p>&nbsp;The script gives a formatted list of references similar to this one:</p>
<div id="scr">
<h3>References</h3>

1. W. Naumann, N. V. Shokhirev, A.Szabo. The exact asymptoyic relaxation of pseudo-first order reversible reactions. <i>Phys. Rev. Lett.</i>, <b>79</b>, 1997 , 3074-3077.<br>
2. N. V. Shokhirev, F. A. Walker. Co- and counter-rotation of magnetic axes and axial ligands in low- spin Ferriheme Systems. <i>J. Am. Chem. Soc.</i>, <b>120</b>, 1998 , 981-990.<br>
3. T. Kh. Shokhireva, N. V. Shokhirev,  F. A. Walker. Assignment of Heme
 Resonances and Determination of the Electronic Structures of High- and 
Low-Spin Nitrophorin 2 by <sup>1</sup>H and <sup>13</sup>C NMR Spectroscopy: An Explanation of the Order of Heme Methyl Resonances in High-Spin Ferriheme Proteins. <i>Biochemistry</i>, <b>42</b>, 2003 , 679-693.<br>
4. M. J. M. Nesset, N. V. Shokhirev, P. D. Enemark, S. E. Jacobson, F. 
A. Walker. Models of the Cytochromes. Redox properties and thermodynamic
 stabilities of Complexes of "Hindered" Iron(III) and Iron(II) 
Tetraphenylporphyrinates with Substituted Pyridines and Imidazoles. <i>Inorg. Chem.</i>, <b>35</b>, 1996 , 5188-5200.

<p>
  <a href="#">Back to management</a>
</p>

</div>

<p><b>Remarks</b>.</p>

<ul>
  <li>The references are listed in an arbitrary order. The variable $linenumber
    is used for the consecutive numbering.</li>
  <li>You can modify the SQL statement for ordering and selection.</li>
</ul>
<p>Example 1. Descending sort by year:</p>

<pre>  $sql = "SELECT r.ridx,r.authors,r.title,j.jname,r.volume,r.year,r.pages,r.no
          FROM $rt r, $jt j WHERE r.jidx=j.jidx ORDER BY -r.year";</pre>


<p>Example2. Search by name:</p>

<pre>  $sql = "SELECT r.ridx,r.authors,r.title,j.jname,r.volume,r.year,r.pages,r.no
          FROM $rt r, $jt j WHERE r.jidx=j.jidx AND r.authors LIKE '%Walker%'";</pre>


<h4>Edit/Delete record</h4>


<p>File edit_db.php:</p>


<pre>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Edit record&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgcolor = "#EEEEF0"&gt;
&lt;?php
include('sqlite_utils.php');
$ref_id=0;

$dh = sqlite_open($db, 0666, $err) or die ($err);

<font color="#FF00FF">// check to see if the form was submitted with ref_id</font>
if (isset($_POST['ref_id_select']))
{
  if (!empty($_POST['ref_id']) )
  {
    $ref_id = sqlite_escape_string($_POST['ref_id']);

    $sql_all = "SELECT r.ridx,r.authors,r.title,r.jidx,r.volume,r.year, r.pages,
	    r.no,r.keywords FROM $rt r, $jt j WHERE (r.jidx=j.jidx AND r.ridx=$ref_id)";
    $result = sqlite_query($dh, $sql_all);

    if (sqlite_num_rows($result) &gt; 0)
    {
      $row = sqlite_fetch_array($result);
      if (is_null($row[4])) {$v = ''; } else {$v =  $row[4];}
      if (is_null($row[7])) {$n = ''; } else {$n =  $row[7];}
      if (is_null($row[6])) {$p = ''; } else {$p =  $row[6];}

      $sql = "SELECT * FROM $jt";
      $res = sqlite_query($dh, $sql);
      if (sqlite_num_rows($result) &gt; 0)
      {
	$option = '&lt;select name="jname"&gt;'."\n";
	while($r = sqlite_fetch_array($res))
	{
	  if ($r[0] == $row[3]) {$r0 = $r[0].' selected';} else {$r0 = $r[0];}
	  $option .= '&lt;option value='.$r0.'&gt;'.$r[1].'&lt;/option&gt;'."\n";
	}
	$option .= "&lt;/select&gt;\n";
      }

        $sinput =
'&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;Authors: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="authors" size="70" value="'.$row[1].'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Title: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="title" size="80" value="'.$row[2].'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Select Journal: &lt;/td&gt;&lt;td&gt;'.$option.'&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Volume: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="volume" size="8" value="'.$v.'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Year: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="year" size="6" value="'.$row[5].'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Pages: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="pages" value="'.$p.'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;No: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="no" size="8" value="'.$n.'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Keywords: &lt;/td&gt;&lt;td&gt;&lt;input type="text" name="keywords" size="80" value="'.$row[8].'"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;input type="submit" name="save" value="Save"&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=reset value="Clear All"&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;b&gt;&lt;font color="red"&gt;Delete Record &lt;/color&gt;&lt;/b&gt;&lt;/td&gt;
      &lt;td&gt;&lt;input type="submit" name="delete" value="Delete"&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;';
    }
  }
}

if (isset($_POST['save'])) <font color="#FF00FF">// save updates</font>
{
  if (!empty($_POST['authors']) &amp;&amp; !empty($_POST['title']) &amp;&amp; !empty($_POST['year']) )
  {
    $ref_id = $_POST['ref_id'];
    $authors = sqlite_escape_string($_POST['authors']);
    $title = sqlite_escape_string($_POST['title']);
    $jidx = sqlite_escape_string($_POST['jname']);
    $volume = sqlite_escape_string($_POST['volume']);
    if ( empty($_POST['volume']) ) {
      $v = 'NULL';
    } else {
      $v = "'".sqlite_escape_string($_POST['volume'])."'";
    }
    $year = sqlite_escape_string($_POST['year']);
    if ( empty($_POST['pages']) ) {$p = 'NULL';}
    else {
      $p = "'".sqlite_escape_string($_POST['pages'])."'";}
    if ( empty($_POST['no']) ) {$n = 'NULL';}
    else {
      $n = "'".sqlite_escape_string($_POST['no'])."'";
    }
    $keywords = sqlite_escape_string($_POST['keywords']);
    $sql = "UPDATE $rt SET authors='$authors',title='$title',volume=$v,
	          year='$year',pages=$p,no=$n,keywords='$keywords',jidx='$jidx'
	    WHERE ridx='$ref_id'";
<font color="#FF00FF">//  echo "sql = $sql&lt;br /&gt;";  // debug</font>
    $result = sqlite_query($dh, $sql) or die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
    echo "&lt;p&gt;&lt;i&gt;Record successfully updated!&lt;/i&gt;&lt;/p&gt;";
  } else {
    echo "&lt;p&gt;&lt;i&gt;Incomplete form input. Record not updated! Go Back&lt;/i&gt;&lt;/p&gt;";
  }
}

if (isset($_POST['delete'])) <font color="#FF00FF">// delete selected record</font>
{
  $ref_id = $_POST['ref_id'];
  $sql = "DELETE FROM $rt WHERE ridx='$ref_id'";
  $result = sqlite_query($dh, $sql) or die("Error in query: ".sqlite_error_string(sqlite_last_error($dh)));
	echo "&lt;p&gt;&lt;i&gt;Record successfully deleted!&lt;/i&gt;&lt;/p&gt;";
}
?&gt;

&lt;h3&gt;References&lt;/h3&gt;
&lt;?php

$sql_all = "SELECT r.ridx,r.authors,r.title,j.jname,r.volume,r.year,r.pages,r.no
          FROM $rt r, $jt j WHERE r.jidx=j.jidx";
$result = sqlite_query($dh, $sql_all);

if (sqlite_num_rows($result) &gt; 0)
{
  $refs = '';
  while($row = sqlite_fetch_array($result))
  {
    if (is_null($row[4])) {$v = ''; } else {$v =  " &lt;b&gt;$row[4]&lt;/b&gt;,";}
    if (is_null($row[7])) {$n = ''; } else {$n =  " No $row[7],";}
    if (is_null($row[6])) {$p = '.'; } else {$p =  ", $row[6].";}
    $refs .= "$row[0]. $row[1]. $row[2]. &lt;i&gt;$row[3]&lt;/i&gt;,$v$n $row[5] $p&lt;br /&gt;";
  }
  echo stripslashes($refs);
}
sqlite_close($dh);

?&gt;

&lt;form method="post" action="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"&gt;

&lt;br /&gt;
Enter Ref ID: &lt;input type="text" name="ref_id" value="&lt;?php echo $ref_id; ?&gt;" size="8"&gt;
&lt;input type="submit" name="ref_id_select" value="OK"&gt;&lt;br&gt;
&lt;br /&gt;
&lt;?php echo $sinput; ?&gt;
&lt;p&gt;
  &lt;a href="manage_db.html"&gt;Back to management&lt;/a&gt;
&lt;/p&gt;
&lt;/form&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;</pre>

<p>This code is functional but still can be refactored (a home exercise).
</p>


<p id="small_bold">
<a href="http://www.shokhirev.com/nikolai/abc/IT/ITtut.php">IT Tutorials </a> &nbsp;|
<a href="http://www.shokhirev.com/nikolai/abc/abc/ABCtut.php">ABC Tutorials </a> &nbsp;|
&nbsp; <a href="http://www.shokhirev.com/nikolai/index.php"> Home</a></p>
<p align="center">
  <img src="SQLite%20with%20PHP_files/ruler.jpg" alt="Ruler" height="10" width="472">
</p>

<table align="right" border="0">
  <tbody><tr>
    <td align="right">
      <img src="SQLite%20with%20PHP_files/mail2.gif" alt="[Mailbox]" border="1" height="40" width="40">
    </td>
    <td align="right">
      <p id="smaller">
      Please e-mail me at <a href="mailto:%20%20%20%20%20%20nikolai@u.arizona.edu">
      nikolai@u.arizona.edu
      </a></p><a href="mailto:%20%20%20%20%20%20nikolai@u.arizona.edu">
    </a></td>
  </tr>
</tbody></table>

<p id="smaller">©Nikolai V. Shokhirev, 2001-2011</p>
  
</body></html>